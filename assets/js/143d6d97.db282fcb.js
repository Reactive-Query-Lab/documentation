"use strict";(globalThis.webpackChunkreactive_query_doc=globalThis.webpackChunkreactive_query_doc||[]).push([[115],{6723:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"1-query-model","title":"Query Model","description":"A framework-agnostic MVVM Model layer library for querying, storing, and caching data in frontend applications using reactive programming.","source":"@site/docs/query-model.md","sourceDirName":".","slug":"/query-model","permalink":"/documentation/docs/query-model","draft":false,"unlisted":false,"editUrl":"https://github.com/Reactive-Query-Lab/reactive-query/docs/query-model.md","tags":[],"version":"current","frontMatter":{"id":"1-query-model","title":"Query Model","sidebar_label":"Query Model","description":"A framework-agnostic MVVM Model layer library for querying, storing, and caching data in frontend applications using reactive programming.","slug":"/query-model"},"sidebar":"tutorialSidebar","previous":{"title":"Introduction","permalink":"/documentation/docs/introduction"},"next":{"title":"Command Model","permalink":"/documentation/docs/command-model"}}');var s=r(4848),i=r(8453);const a={id:"1-query-model",title:"Query Model",sidebar_label:"Query Model",description:"A framework-agnostic MVVM Model layer library for querying, storing, and caching data in frontend applications using reactive programming.",slug:"/query-model"},d=void 0,o={},l=[{value:"Thinking with Query Models",id:"thinking-with-query-models",level:3},{value:"Vault and Store",id:"vault-and-store",level:3},{value:"Query and Refresh",id:"query-and-refresh",level:3},{value:"Key Hashing and Parameters",id:"key-hashing-and-parameters",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Cache Invalidation Strategy Trade-offs",id:"cache-invalidation-strategy-trade-offs",level:4},{value:"Query API Reference",id:"query-api-reference",level:3},{value:"Exported Types",id:"exported-types",level:4},{value:"Protected Methods (Can be overridden)",id:"protected-methods-can-be-overridden",level:4},{value:"Public Methods",id:"public-methods",level:4},{value:"Configuration Options",id:"configuration-options",level:4}];function c(e){const n={code:"code",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Query Models handle read operations and implement intelligent caching strategies."}),"\n",(0,s.jsx)(n.h3,{id:"thinking-with-query-models",children:"Thinking with Query Models"}),"\n",(0,s.jsxs)(n.p,{children:["Query Models are designed around the concept of ",(0,s.jsx)(n.strong,{children:"parameterized queries"})," that return cached results. Think of them as smart data fetchers that:"]}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cache by parameters"})," - Different parameters create different cache entries"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Auto-refresh stale data"})," - Automatically fetch fresh data when cache expires"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Handle loading states"})," - Provide loading, error, and success states"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Retry on failure"})," - Automatically retry failed requests"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"vault-and-store",children:"Vault and Store"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Vault"}),": A collection of stores indexed by hashed parameters. Think of it as a cache container."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Store"}),": Individual cache entries containing data, loading states, and metadata."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// Vault structure\n{\n  "user_123": { data: User, isLoading: false, isFetched: true, ... },\n  "user_456": { data: User, isLoading: true, isFetched: false, ... },\n  "products_filters": { data: Product[], isLoading: false, isFetched: true, ... }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"query-and-refresh",children:"Query and Refresh"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Query"}),": The public method that returns an observable of query results."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Refresh"}),": The protected method you implement to fetch data from your API."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"class UserQueryModel extends ReactiveQueryModel<User> {\n  protected async refresh(userId: number): Promise<User> {\n    const response = await fetch(`/api/users/${userId}`);\n    if (!response.ok) throw new Error('Failed to fetch user');\n    return response.json();\n  }\n}\n\n// Usage\nconst userModel = new UserQueryModel();\nconst user$ = userModel.query(123); // Observable<User>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"key-hashing-and-parameters",children:"Key Hashing and Parameters"}),"\n",(0,s.jsx)(n.p,{children:"Parameters are automatically hashed to create cache keys. The library provides intelligent hashing that:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Handles primitive values (strings, numbers, booleans)"}),"\n",(0,s.jsx)(n.li,{children:"Sorts object keys for consistent hashing (Just one layer to avoid heavy time complexity. You can overwrite hashing logics for custom algorithms)"}),"\n",(0,s.jsx)(n.li,{children:"Handles arrays and nested objects"}),"\n",(0,s.jsx)(n.li,{children:"Supports custom hashing algorithms"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// These all create the same hash key\nuserModel.query({ id: 123, include: 'profile' });\nuserModel.query({ include: 'profile', id: 123 });\n\n// Different parameters create different cache entries\nuserModel.query(123);        // Key: \"123\"\nuserModel.query(456);        // Key: \"456\"\nuserModel.query({ id: 123 }); // Key: '{\"id\":123}'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Query Models support various configuration options:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"class UserQueryModel extends ReactiveQueryModel<User> {\n  protected get configs() {\n    return {\n      maxRetryCall: 3,           // Retry failed requests 3 times\n      cachTime: 5 * 60 * 1000,   // Cache for 5 minutes\n      emptyVaultOnNewValue: false, // Keep old cache when new data arrives\n      initStore: {\n        key: 'default',\n        value: { id: 0, name: 'Loading...' },\n        staleTime: 60 * 1000\n      },\n      cacheInvalidationStrategy: CacheInvalidationStrategy.GRACEFUL\n    };\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"cache-invalidation-strategy-trade-offs",children:"Cache Invalidation Strategy Trade-offs"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"FORCE Strategy:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," Ensures data is refreshed immediately after cache expiration, giving users access to the latest data quickly."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cons:"})," May lead to frequent data fetching even if the data hasn't changed, potentially increasing network load and affecting performance."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"GRACEFUL Strategy:"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Pros:"})," Efficient in terms of performance, as it retains data in the cache as long as it's being used. This reduces network requests and minimizes the chances of glitches."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cons:"})," Users might experience a delay in data refresh since the cache checks only occur when no active observers are present."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"query-api-reference",children:"Query API Reference"}),"\n",(0,s.jsx)(n.h4,{id:"exported-types",children:"Exported Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Main response type for queries\ntype QueryResponse<DATA> = {\n  data?: DATA;\n  isLoading: boolean;\n  isFetching: boolean;\n  isFetched: boolean;\n  error?: unknown;\n  staled: boolean;\n  staleTime?: number;\n  lastFetchedTime?: number;\n};\n\n// Base store type\ntype BaseReactiveStore<DATA> = {\n  data: DATA;\n  isLoading: boolean;\n  isFetching: boolean;\n  isFetched: boolean;\n  error?: unknown;\n  staled: boolean;\n  staleTime?: number;\n  lastFetchedTime?: number;\n};\n\n// Vault type for multiple stores\ntype ReactiveQueryVault<DATA, EVENTS = undefined> = {\n  store$: Observable<{ [key: string]: BaseReactiveStore<DATA> }>;\n} & QueryVaultEvents<DATA> & EVENTS;\n"})}),"\n",(0,s.jsx)(n.h4,{id:"protected-methods-can-be-overridden",children:"Protected Methods (Can be overridden)"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Override to implement your data fetching logic\nprotected abstract refresh(params?: unknown): Promise<DATA>;\n\n// Override for custom parameter hashing\nprotected getHashedKey(params?: unknown): string;\n\n// Override for custom configuration\nprotected get configs(): {\n  maxRetryCall: number;\n  cachTime: number;\n  emptyVaultOnNewValue: boolean;\n  initStore?: {\n    key: string;\n    value: DATA;\n    staleTime?: number;\n  };\n};\n"})}),"\n",(0,s.jsx)(n.h4,{id:"public-methods",children:"Public Methods"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:"// Main query method\nquery(params?: unknown, configs?: { staleTime?: number }): Observable<QueryResponse<DATA>>\n\n// Store management\nget storeHandler(): {\n  invalidate(): void;\n  invalidateByKey(params?: unknown): void;\n  resetStore(params?: unknown): void;\n  resetVault(): void\n}\n\n// Utility methods\nisSameBaseData(prev: QueryResponse<DATA>, curr: QueryResponse<DATA>): boolean;\n"})}),"\n",(0,s.jsx)(n.h4,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Option"}),(0,s.jsx)(n.th,{children:"Type"}),(0,s.jsx)(n.th,{children:"Default"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"maxRetryCall"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"number"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"1"})}),(0,s.jsx)(n.td,{children:"Maximum retry attempts for failed requests"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"cachTime"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"number"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"3 * 60 * 1000"})}),(0,s.jsx)(n.td,{children:"Default cache time in milliseconds"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"emptyVaultOnNewValue"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"boolean"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"false"})}),(0,s.jsx)(n.td,{children:"Clear vault when new data arrives"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"initStore"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"object"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"undefined"})}),(0,s.jsx)(n.td,{children:"Initial store configuration"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"cacheInvalidationStrategy"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheInvalidationStrategy"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheInvalidationStrategy.GRACEFUL"})}),(0,s.jsx)(n.td,{children:"Cache invalidation strategy"})]})]})]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>d});var t=r(6540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);